flowchart TD
  A[CPU jumps to kernel_main] --> B[terminal_initialize(): clear VGA text buffer]
  B --> C[Build structured GDT array]
  C --> D[gdt_structured_to_gdt() -> gdt_real]
  D --> E[gdt_load(gdt_real)]
  E --> F[kheap_init()]
  F --> G[fs_init()]
  G --> H[disk_search_and_init()]
  H --> I[idt_init()]
  I --> J[Zero tss; set tss.esp0=0x600000; tss.ss0=KERNEL_DATA_SELECTOR]
  J --> K[tss_load(0x28)]
  K --> L[paging_new_4gb(WRITEABLE|PRESENT|FROM_ALL)]
  L --> M[paging_switch(kernel_chunk)]
  M --> N[enable_paging()]
  N --> O[isr80h_register_commands()]
  O --> P[keyboard_init()]
  P --> Q[process_load_switch("0:/blank.elf")]
  Q -->|error| Qe[panic("Failed to load blank.elf")]
  Q -->|ok| R[Build command_argument "Testing!"]
  R --> S[process_inject_arguments(process, arg)]
  S --> T[process_load_switch("0:/blank.elf") (again)]
  T -->|error| Te[panic("Failed to load blank.elf")]
  T -->|ok| U[Update arg to "Abc!"]
  U --> V[process_inject_arguments(process, arg)]
  V --> W[task_run_first_ever_task() -> start scheduler]
  W --> X[[while(1) {} (idle loop in kernel context)]]
